---
title: "Management Guide" 
description: "Configuration, operations, and maintenance"
---

:::info Enterprise Only
This section is only relevant to Enterprise customers who acquired an on-prem license.
:::

# Management Guide

Learn how to configure, manage, and maintain your Permit Platform deployment.

## Configuration Management

### Primary Configuration File

All platform configuration is managed through `charts/permit-platform/values.yaml`. The key sections you can customize:

#### Required Configuration

```yaml
# Must be configured before installation
global:
  frontendDomain: "permit.yourcompany.com"  # REQUIRED - Replace CHANGEME_FRONTEND_DOMAIN

permitServices:
  policySync:
    enabled: true
    policyRepoUrl: "git@github.com:yourorg/permit-policies.git"  # REQUIRED
    sshPrivateKey: |  # REQUIRED
      -----BEGIN OPENSSH PRIVATE KEY-----
      [Your SSH private key]
      -----END OPENSSH PRIVATE KEY-----
```

#### Common Customizations

**1. Custom Image Registry:**
```yaml
global:
  imageRegistry: "myregistry.company.com"  # Your private registry
  # Or for cloud providers:
  # imageRegistry: "123456789.dkr.ecr.region.amazonaws.com"  # AWS ECR
  # imageRegistry: "myregistry.azurecr.io"  # Azure
  # imageRegistry: "gcr.io/project-id"  # GCP
```

**2. Resource Scaling:**
```yaml
permitServices:
  backend:
    replicas: 3  # Scale backend for high availability
    resources:
      requests:
        memory: "2Gi"
        cpu: "1000m"
      limits:
        memory: "4Gi"
        cpu: "2000m"
```

**3. Storage Configuration:**
```yaml
thirdPartyServices:
  postgres:
    persistence:
      size: "50Gi"  # Increase for production
      storageClass: "fast-ssd"  # Use specific storage class
  
  opensearch:
    persistence:
      size: "100Gi"  # For production audit logs
```

**4. OpenSearch Tuning:**
```yaml
opensearch:
  indexSettings:
    auditLogs:
      numberOfShards: 1  # Single-node: 1, Multi-node: 3-5
      numberOfReplicas: 0  # Single-node: 0, HA: 1+
  ism:
    rollover:
      minSize: "50gb"  # Adjust based on volume
      minAge: "30d"   # Retention period
```

### Applying Configuration Changes

After modifying `values.yaml`:

```bash
# Upgrade deployment with new configuration
helm upgrade permit-platform charts/permit-platform -n permit-platform

# Check rollout status
kubectl rollout status deployment -n permit-platform

# Verify changes
kubectl get pods -n permit-platform
```

## Daily Operations

### Platform Health Monitoring

```bash
# Check all pods status
kubectl get pods -n permit-platform

# Get detailed pod information
kubectl describe pods -n permit-platform

# Check service endpoints
kubectl get services -n permit-platform

# View recent events
kubectl get events -n permit-platform --sort-by='.lastTimestamp'
```

### Log Management

```bash
# View backend logs
kubectl logs -n permit-platform deployment/permit-backend-v2 --tail=100

# Follow logs in real-time
kubectl logs -n permit-platform deployment/permit-backend-v2 -f

# View logs for crashed pods
kubectl logs -n permit-platform <pod-name> --previous

# Export all logs
kubectl logs -n permit-platform --all-containers=true > platform-logs.txt
```

### Service Management

```bash
# Restart specific service
kubectl rollout restart deployment/permit-backend-v2 -n permit-platform

# Restart all services
kubectl rollout restart deployment -n permit-platform

# Restart specific service
./scripts/restart.sh backend

# Reload configuration
./scripts/reload.sh
```

## Scaling Operations

### Horizontal Scaling

```bash
# Scale backend services
./scripts/scale.sh backend --replicas 5

# Scale worker processes
./scripts/scale.sh celery --replicas 3

# Scale PDP instances
./scripts/scale.sh pdp --replicas 8

# Auto-scaling (if configured)
./scripts/scale.sh --auto-enable
```

### Resource Adjustment

```bash
# Increase memory allocation
./scripts/resources.sh backend --memory 4Gi

# Adjust CPU limits
./scripts/resources.sh celery --cpu 1000m

# View current resource allocation
./scripts/resources.sh --show
```

## Git Repository Management

### Policy Synchronization

```bash
# Check policy sync pod status
kubectl get pods -n permit-platform -l app=permit-policy-sync-v2

# View policy sync logs
kubectl logs -n permit-platform deployment/permit-policy-sync-v2

# Check OPAL server status (coordinates policy distribution)
kubectl logs -n permit-platform deployment/opal-server

# Restart policy sync if needed
kubectl rollout restart deployment/permit-policy-sync-v2 -n permit-platform
```

### Repository Updates

```bash
# Update Git repository configuration in values.yaml
vi charts/permit-platform/values.yaml

# Update the policy sync secret with new SSH key
kubectl create secret generic policy-sync-ssh-key -n permit-platform \
  --from-literal=private-key="$(cat new-private-key)" \
  --from-literal=repo-url="git@github.com:neworg/new-policies.git" \
  --dry-run=client -o yaml | kubectl apply -f -

# Restart services to pick up new configuration
kubectl rollout restart deployment/permit-policy-sync-v2 -n permit-platform
kubectl rollout restart deployment/opal-server -n permit-platform
```

## Backup and Recovery

### Creating Backups

```bash
# Full platform backup
./scripts/backup.sh --full

# Database only backup
./scripts/backup.sh --database

# Configuration backup
./scripts/backup.sh --config

# Automated backup setup
./scripts/backup.sh --schedule daily
```

### Backup Management

```bash
# List available backups
./scripts/backup.sh --list

# Restore from backup
./scripts/restore.sh --backup backup-20241201-143022.tar.gz

# Cleanup old backups (keep last 30 days)
./scripts/backup.sh --cleanup 30
```

## Updates and Upgrades

### Platform Updates

```bash
# Extract new version package
tar -xzf permit-platform-on-prem-installer-v2.0.0.tar.gz
cd permit-platform-on-prem-installer-v2.0.0

# Backup current configuration
cp /path/to/current/charts/permit-platform/values.yaml ./values-backup.yaml

# Update configuration with your settings
vi charts/permit-platform/values.yaml

# Run installation (automatically upgrades existing deployment)
./scripts/install-permit-platform.sh

# Verify upgrade completed successfully
kubectl get pods -n permit-platform
helm list -n permit-platform
```

### Rollback Procedures

```bash
# Rollback using Helm (most recent release)
helm rollback permit-platform -n permit-platform

# Rollback to specific release number
helm history permit-platform -n permit-platform
helm rollback permit-platform 3 -n permit-platform

# Check rollback status
helm status permit-platform -n permit-platform
./scripts/rollback.sh --emergency
```

## Security Maintenance

### Certificate Management

```bash
# Check certificate status
./scripts/certificates.sh --status

# Renew certificates
./scripts/certificates.sh --renew

# Update custom certificates
./scripts/certificates.sh --update \
  --cert ./new-cert.pem \
  --key ./new-key.pem
```

### Password Rotation

```bash
# Update database passwords in secrets
kubectl patch secret postgres-secret -n permit-platform \
  --type='merge' -p='{"data":{"password":"'$(echo -n 'new-password' | base64)'"}}'

# Update service passwords in backend secret  
kubectl patch secret permit-backend-v2-secret -n permit-platform \
  --type='merge' -p='{"data":{"PG_DSN":"'$(echo -n 'postgresql+asyncpg://permit:new-password@postgres:5432/permit' | base64)'"}}'

# Restart affected services
kubectl rollout restart deployment -n permit-platform
```

### Security Auditing

```bash
# Check pod security context
kubectl get pods -n permit-platform -o jsonpath='{range .items[*]}{.metadata.name}{": "}{.spec.securityContext}{"\n"}{end}'

# Review service account permissions
kubectl describe serviceaccount -n permit-platform

# Check for privileged containers
kubectl get pods -n permit-platform -o jsonpath='{range .items[*]}{.metadata.name}{": "}{.spec.containers[*].securityContext.privileged}{"\n"}{end}'

# Audit logs from OpenSearch
kubectl port-forward -n permit-platform svc/opensearch 9200:9200 &
curl "http://localhost:9200/audit_logs/_search?q=*&size=100"
```

## Monitoring and Alerting

### Health Monitoring

```bash
# Monitor pod health and resource usage
kubectl top pods -n permit-platform

# Generate health report
./scripts/health-report.sh

# Check service endpoints
./scripts/health-check.sh --endpoints
```

### Performance Monitoring

```bash
# Performance metrics
./scripts/metrics.sh --performance

# Resource utilization
./scripts/metrics.sh --resources

# Response time analysis
./scripts/metrics.sh --response-times
```

## Multi-Server Management

### Cluster Operations

```bash
# View cluster status
./scripts/cluster.sh --status

# Add new node to cluster
./scripts/cluster.sh --add-node <new-server-ip>

# Remove node from cluster
./scripts/cluster.sh --remove-node <server-ip>

# Cluster health check
./scripts/cluster.sh --health
```

### Load Balancing

```bash
# Check load balancer status
./scripts/loadbalancer.sh --status

# Update load balancer configuration
./scripts/loadbalancer.sh --update

# Test load distribution
./scripts/loadbalancer.sh --test
```

## Troubleshooting Commands

### System Diagnostics

```bash
# Comprehensive system check
./scripts/diagnostics.sh --full

# Network connectivity test
./scripts/diagnostics.sh --network

# Storage health check
./scripts/diagnostics.sh --storage
```

### Log Collection for Support

```bash
# Collect all pod logs for support
kubectl logs -n permit-platform --all-containers=true --selector=app!=postgres > permit-platform-logs.txt

# Collect system information
kubectl get pods,svc,ingress,pv,pvc -n permit-platform -o wide > system-info.txt
kubectl get events -n permit-platform --sort-by='.lastTimestamp' > events.txt

# Create support bundle
tar -czf permit-platform-support-$(date +%Y%m%d-%H%M%S).tar.gz \
  permit-platform-logs.txt system-info.txt events.txt
# Add resource usage information
kubectl top pods -n permit-platform > resource-usage.txt
kubectl top nodes > node-usage.txt

# Include all files in support bundle
tar -czf permit-platform-support-$(date +%Y%m%d-%H%M%S).tar.gz \
  *.txt
```

## Maintenance Windows

### Planned Maintenance

```bash
# Enable maintenance mode
./scripts/maintenance.sh --enable

# Perform maintenance tasks
./scripts/maintenance.sh --run-tasks

# Disable maintenance mode
./scripts/maintenance.sh --disable
```

### Emergency Procedures

```bash
# Emergency stop
./scripts/emergency.sh --stop

# Emergency restart
./scripts/emergency.sh --restart

# Safe mode startup
./scripts/emergency.sh --safe-mode
```

## Configuration Management

### Environment Variables

```bash
# View current configuration
./scripts/config.sh --show

# Update configuration
./scripts/config.sh --set KEY=VALUE

# Reload configuration
./scripts/config.sh --reload
```

### Feature Toggles

```bash
# Enable/disable features
./scripts/features.sh --enable feature-name
./scripts/features.sh --disable feature-name

# List available features
./scripts/features.sh --list
```

---

**Need help with troubleshooting?** Check the [Troubleshooting Guide](/how-to/deploy/on-prem/troubleshooting) →